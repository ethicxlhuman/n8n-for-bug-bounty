{
  "name": "etxHackerOne Scope Monitor",
  "nodes": [
    {
      "parameters": {
        "content": "## âš™ï¸ Data Sync\n- Runs automatically every 20 minutes to keep data fresh.  \n- Fetches and aggregates HackerOne program data using GraphQL batching.  \n- Normalizes and merges results for clean downstream processing.  \n- Ensures local database stays aligned with live HackerOne data.\n",
        "height": 224,
        "width": 308,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3856,
        -672
      ],
      "id": "50577698-a1de-4d3c-ae7e-3451103a56c6",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ðŸ“¢ Notifications & Reporting\n- Sends structured Discord alerts summarizing new programs and scope updates.  \n- Includes handle, direct link, and old vs. new scope version details.  \n- Provides instant visibility for researchers tracking program scope evolution.",
        "height": 192,
        "width": 372,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        192,
        -656
      ],
      "id": "ab47d6c4-e7b9-478a-be52-b3262e1e010b",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bcd40a85-48f9-4050-ba7e-2684c0ddb0a2",
              "name": "numbers",
              "value": "={{ Array.from({ length: 3 }, (_, i) => (i+1) * 100) }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3040,
        -880
      ],
      "id": "47c1ef02-f003-4280-85f7-c419fcb2326f",
      "name": "Pagination Setup (100-300)"
    },
    {
      "parameters": {
        "fieldToSplitOut": "numbers",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2848,
        -880
      ],
      "id": "2b0cbc61-434d-480c-90ef-4d0b3713bc12",
      "name": "Split Pagination Values"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hackerone.com/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Host",
              "value": "hackerone.com"
            },
            {
              "name": "Content-Length",
              "value": "584"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"operationName\": \"DiscoveryQuery\",\n  \"query\": \"query DiscoveryQuery($query: OpportunitiesQuery!, $filter: QueryInput!, $from: Int, $size: Int, $sort: [SortInput!]) {\\n  opportunities_search(query: $query, filter: $filter, from: $from, size: $size, sort: $sort) {\\n    nodes {\\n      ... on OpportunityDocument {\\n        handle\\n      }\\n    }\\n  }\\n}\",\n  \"variables\": {\n    \"query\": {},\n    \"filter\": {\n      \"bool\": {\n        \"filter\": [\n          {\n            \"bool\": {\n              \"must_not\": {\n                \"term\": {\n                  \"team_type\": \"Engagements::Assessment\"\n                }\n              }\n            }\n          },\n          {\n            \"term\": {\n              \"offers_bounties\": true\n            }\n          }\n        ]\n      }\n    },\n    \"from\": {{ $json.numbers }},\n    \"size\": 100,\n    \"sort\": [\n      {\n        \"field\": \"launched_at\",\n        \"direction\": \"DESC\"\n      }\n    ]\n  }\n}",
        "options": {
          "allowUnauthorizedCerts": true,
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2608,
        -720
      ],
      "id": "fb08e007-d84d-445f-a796-82d976cec600",
      "name": "Fetch HackerOne Programs"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -2400,
        -880
      ],
      "id": "a656f20b-4cb3-42c2-8e87-4a9d07384d3b",
      "name": "Merge Program Data"
    },
    {
      "parameters": {
        "jsCode": "// Get the input data\nconst items = $input.all();\n\n// Initialize an array to store all handles\nconst handles = [];\n\n// Loop through each input item\nfor (const item of items) {\n  const nodes = item.json.data.opportunities_search.nodes;\n\n  // Extract handles and push them into the handles array\n  for (const node of nodes) {\n    handles.push(node.handle);\n  }\n}\n\n// Return a single output item with the handles array\nreturn [\n  {\n    json: {\n      handles\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2208,
        -880
      ],
      "id": "42e8c78c-3db0-4022-b215-9c62509dd289",
      "name": "Extract Program Handles"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nreturn items.map(item => {\n  const team = item.json.data.team;\n  const handle = team.handle;\n  const latest_scope_version_id = team.structured_scope_versions.edges[0]?.node?.id || null;\n\n  return {\n    json: {\n      handle,\n      latest_scope_version_id\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        -880
      ],
      "id": "727497c8-88bc-4f80-82c8-42a8eec0d020",
      "name": "Extract Scope Versions"
    },
    {
      "parameters": {
        "fieldToSplitOut": "handles",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1968,
        -880
      ],
      "id": "b2dbf1f2-aa15-4f7e-b909-483411e31c91",
      "name": "Split Program Handles"
    },
    {
      "parameters": {
        "mergeByFields": {
          "values": [
            {
              "field1": "handle",
              "field2": "handle"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.compareDatasets",
      "typeVersion": 2.3,
      "position": [
        -1008,
        -656
      ],
      "id": "ae802211-3a3c-4fdf-9c7d-062e14c6125b",
      "name": "Compare with Database"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "hackerone-programs",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2240,
        -304
      ],
      "id": "26ff9024-3683-490f-bf68-fa1d6bdb3302",
      "name": "Get Existing Programs",
      "credentials": {
        "supabaseApi": {
          "id": "3JbeTDFdmOJXtsJR",
          "name": "john supabase | nahamsec"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ee3772ed-3a57-4232-805f-89dc9fa10e41",
              "name": "handle",
              "value": "={{ $json.program_name }}",
              "type": "string"
            },
            {
              "id": "dda1f4ff-6469-4cf8-88d8-2083b6cb7061",
              "name": "latest_scope_version_id",
              "value": "={{ $json.latest_scope_version_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2000,
        -304
      ],
      "id": "7d6a128b-c92c-4504-bcce-d24bffd87d0a",
      "name": "Prepare DB Data"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "hackerone-programs",
        "filters": {
          "conditions": [
            {
              "keyName": "program_name",
              "condition": "eq",
              "keyValue": "={{ $json.keys.handle }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "latest_scope_version_id",
              "fieldValue": "={{ $json.different.latest_scope_version_id.inputA }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -432,
        -704
      ],
      "id": "1288fb92-48ec-4dcb-91b0-9a7c5b7427f1",
      "name": "Update Scope Version",
      "credentials": {
        "supabaseApi": {
          "id": "3JbeTDFdmOJXtsJR",
          "name": "john supabase | nahamsec"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3424,
        -608
      ],
      "id": "e0366125-e55c-4659-8856-a9821a428a60",
      "name": "Schedule Trigger (20min)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hackerone.com/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"operationName\": \"ScopeVersionQuery\",\n  \"variables\": {\n    \"handle\": \"{{ $json.handles }}\"\n  },\n  \"query\": \"query ScopeVersionQuery($handle: String!) {\\n  team(handle: $handle) {\\n          handle\\n    structured_scope_versions(first: 1) {\\n      edges {\\n        node {\\n          id\\n          created_at\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\"\n}",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 25,
              "batchInterval": 5000
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1744,
        -880
      ],
      "id": "783b3128-7392-4a70-b1c2-92f3eb8203eb",
      "name": "Get Scope Versions"
    },
    {
      "parameters": {
        "tableId": "hackerone-programs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "program_name",
              "fieldValue": "={{ $json.handle }}"
            },
            {
              "fieldId": "latest_scope_version_id",
              "fieldValue": "={{ $json.latest_scope_version_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -512,
        -1376
      ],
      "id": "c4e8beae-976e-4ece-a0fa-223fc2dc826f",
      "name": "Create New Program",
      "credentials": {
        "supabaseApi": {
          "id": "3JbeTDFdmOJXtsJR",
          "name": "john supabase | nahamsec"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 2,
      "position": [
        -1296,
        -880
      ],
      "id": "ab9f26ee-7bdd-4016-b39c-64c87daa81f0",
      "name": "Remove Duplicates"
    },
    {
      "parameters": {
        "authentication": "webhook",
        "content": "=# **ðŸ—½ NEW HackerOne Program ADDED**\n\n**Program:** {{ $json.handle }}\n\n**Scope Version:** {{ $json.latest_scope_version_id }}",
        "options": {
          "avatar_url": "https://cdn.theorg.com/21070d4f-a207-44e3-9212-22c2e1497205_thumb.jpg"
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -272,
        -1120
      ],
      "id": "cd629163-11a9-4335-a121-5cb9ec33c34f",
      "name": "Discord New Program Alert",
      "webhookId": "894c380b-33e4-4053-ac37-ef0df0b19a34",
      "credentials": {
        "discordWebhookApi": {
          "id": "dlUJMSl5jrn0dkj5",
          "name": "Hackerone Shoten"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a9f77fc4-f039-48ba-9fb7-4c10e3e96a56",
              "name": "handle",
              "value": "={{ $json.keys.handle }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -656,
        -48
      ],
      "id": "2fc88f3c-557a-4f44-9156-83678debd969",
      "name": "Extract Handle for Lookup"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hackerone.com/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"operationName\": \"getProgramScopes\",\n  \"variables\": {\n    \"handle\": \"{{ $json.handle }}\"\n  },\n  \"query\": \"query getProgramScopes($handle: String!, $after: String) {\\n  team(handle: $handle) {\\n    handle\\n    structured_scopes(first: 100, after: $after, archived: false) {\\n      nodes {\\n        asset_identifier\\n        asset_type\\n        eligible_for_submission\\n        eligible_for_bounty\\n        max_severity\\n        instruction\\n      }\\n    }\\n  }\\n}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -304,
        -160
      ],
      "id": "8c475871-e4ae-4586-bf5b-ef738818f54a",
      "name": "Fetch Updated Scope Details"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "hackerone-programs",
        "filters": {
          "conditions": [
            {
              "keyName": "program_name",
              "keyValue": "={{ $json.handle }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -304,
        112
      ],
      "id": "8db57224-2dc0-4592-a25b-7ffe7e25620a",
      "name": "Get Previous Scope",
      "credentials": {
        "supabaseApi": {
          "id": "3JbeTDFdmOJXtsJR",
          "name": "john supabase | nahamsec"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a41d24b7-f89d-471b-a88f-f9ffa3ea547c",
              "name": "handle",
              "value": "={{ $json.program_name }}",
              "type": "string"
            },
            {
              "id": "ffdcd8fa-a2eb-4e01-9cde-c1a1fb96f5fa",
              "name": "inscope",
              "value": "={{ $json.inscope }}",
              "type": "array"
            },
            {
              "id": "75e39faf-d42e-405c-be3a-4b3b00a44ec9",
              "name": "outofscope",
              "value": "={{ $json.outofscope }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        112
      ],
      "id": "0031e201-e154-40f8-b9eb-12eb1888c491",
      "name": "Prepare Previous Scope"
    },
    {
      "parameters": {
        "mergeByFields": {
          "values": [
            {
              "field1": "handle",
              "field2": "handle"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.compareDatasets",
      "typeVersion": 2.3,
      "position": [
        272,
        -48
      ],
      "id": "30d4ce85-17a6-4fcc-94c6-96b445ff73e8",
      "name": "Compare Scope Changes"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "hackerone-programs",
        "filters": {
          "conditions": [
            {
              "keyName": "program_name",
              "condition": "eq",
              "keyValue": "={{ $json.keys.handle }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "inscope",
              "fieldValue": "={{ $json.different.inscope.inputA }}"
            },
            {
              "fieldId": "outofscope",
              "fieldValue": "={{ $json.different.outofscope.inputA }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        -144
      ],
      "id": "ca0bb14e-1d9b-4a2b-a372-7bf51db086a9",
      "name": "Update Program Scope",
      "credentials": {
        "supabaseApi": {
          "id": "3JbeTDFdmOJXtsJR",
          "name": "john supabase | nahamsec"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst handle = input.keys?.handle || 'unknown';\n\n// Normalize utility\nconst normalize = (s) =>\n  s?.toLowerCase()\n    .replace(/\\u200B/g, '')\n    .replace(/[â€œâ€\"']/g, '')\n    .replace(/[()]+$/, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n\nconst normalizeList = (list) =>\n  Array.isArray(list) ? [...new Set(list.map(normalize))] : [];\n\nconst inscopeA = normalizeList(input?.different?.inscope?.inputA || []);\nconst inscopeB = normalizeList(input?.different?.inscope?.inputB || []);\nconst outofscopeA = normalizeList(input?.different?.outofscope?.inputA || []);\nconst outofscopeB = normalizeList(input?.different?.outofscope?.inputB || []);\n\n// Only check for ADDITIONS\nconst inscope_added = inscopeA.filter(x => !inscopeB.includes(x));\nconst outofscope_added = outofscopeA.filter(x => !outofscopeB.includes(x));\n\nif (!inscope_added.length && !outofscope_added.length) {\n  return []; // Silent skip if nothing meaningful was added\n}\n\nreturn [\n  {\n    json: {\n      program_name: handle,\n      inscope_added: inscope_added.sort(),\n      outofscope_added: outofscope_added.sort()\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        112
      ],
      "id": "bf30e082-2245-47f8-b2de-8b0ec7fe2520",
      "name": "Process Scope Changes"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hackerone.com/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Host",
              "value": "hackerone.com"
            },
            {
              "name": "Content-Length",
              "value": "582"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"operationName\": \"DiscoveryQuery\",\n  \"query\": \"query DiscoveryQuery($query: OpportunitiesQuery!, $filter: QueryInput!, $from: Int, $size: Int, $sort: [SortInput!]) {\\n  opportunities_search(query: $query, filter: $filter, from: $from, size: $size, sort: $sort) {\\n    nodes {\\n      ... on OpportunityDocument {\\n        handle\\n      }\\n    }\\n  }\\n}\",\n  \"variables\": {\n    \"query\": {},\n    \"filter\": {\n      \"bool\": {\n        \"filter\": [\n          {\n            \"bool\": {\n              \"must_not\": {\n                \"term\": {\n                  \"team_type\": \"Engagements::Assessment\"\n                }\n              }\n            }\n          },\n          {\n            \"term\": {\n              \"offers_bounties\": true\n            }\n          }\n        ]\n      }\n    },\n    \"from\": 0,\n    \"size\": 100,\n    \"sort\": [\n      {\n        \"field\": \"launched_at\",\n        \"direction\": \"DESC\"\n      }\n    ]\n  }\n}",
        "options": {
          "allowUnauthorizedCerts": true,
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2608,
        -1040
      ],
      "id": "51dd2fda-4dc3-48d5-b569-b1ccc5a23724",
      "name": "Parallel Fetch Programs"
    },
    {
      "parameters": {
        "content": "## ðŸ§  Scope Monitoring\n- Extracts each programâ€™s scope version and removes duplicates.  \n- Compares latest scope data with stored records to detect:  \n  ðŸ”¹ New program launches  \n  ðŸ”¹ Scope version updates  \n  ðŸ”¹ Removed or revoked scopes  \n- Updates database entries and categorizes all detected changes.",
        "height": 256,
        "width": 352
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1968,
        -1280
      ],
      "id": "3cdc31f4-3a13-4b42-b835-adcc9661184d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// Collect all input data\nconst inputData = items.map(item => item.json.data);\n\nconst results = [];\n\nfor (const data of inputData) {\n\tconst team = data?.team;\n\tif (!team) continue;\n\n\tconst handle = team.handle || '';\n\tconst inscope = new Set();\n\tconst outofscope = new Set();\n\n\tconst nodes = team.structured_scopes?.nodes || [];\n\tfor (const asset of nodes) {\n\t\tconst id = asset.asset_identifier?.trim();\n\t\tif (!id) continue;\n\n\t\tif (asset.eligible_for_bounty === true) {\n\t\t\tinscope.add(id);\n\t\t} else {\n\t\t\toutofscope.add(id);\n\t\t}\n\t}\n\n\tresults.push({\n\t\thandle,\n\t\tinscope: Array.from(inscope).sort(),\n\t\toutofscope: Array.from(outofscope).sort()\n\t});\n}\n\nreturn results.map(r => ({ json: r }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        -160
      ],
      "id": "7983fb1e-b079-4c85-8be6-eb9ff3c39ddf",
      "name": "Format Scope Update Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10ccd513-e685-4729-953b-e25fcea0a755",
              "name": "program_name",
              "value": "={{ $json.keys.handle }}",
              "type": "string"
            },
            {
              "id": "88220ac6-e1cd-4fb2-b767-42e459beff65",
              "name": "keys.handle",
              "value": "=https://hackerone.com/{{ $json.keys.handle }}/scope_versions",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        -432
      ],
      "id": "91b71092-42bb-4366-acd9-94a77191d02f",
      "name": "Program Scope Update"
    },
    {
      "parameters": {
        "authentication": "webhook",
        "content": "=# **ãŠ™ï¸ SCOPE-VERSION Changed**\n\n**Program:** `{{ $json.program_name }}`\n\n**Scope Version:** {{ $json.keys.handle }}\n\n",
        "options": {
          "avatar_url": "https://cdn.theorg.com/21070d4f-a207-44e3-9212-22c2e1497205_thumb.jpg"
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -208,
        -432
      ],
      "id": "c85329df-8e0e-43aa-8b71-1647b9c566a1",
      "name": "Discord SCOPE-VERSION Alert",
      "webhookId": "39b357db-4578-4f56-a4b6-13924b096984",
      "credentials": {
        "discordWebhookApi": {
          "id": "dlUJMSl5jrn0dkj5",
          "name": "Hackerone Shoten"
        }
      }
    },
    {
      "parameters": {
        "authentication": "webhook",
        "content": "=# **ðŸ›¡ï¸ Program Updated**\n\n**Program:** {{ $json.program_name }}\n\n**Scope_Version**: https://hackerone.com/{{ $json.program_name }}/scope_versions\n\n{{ $json.inscope_added.length > 0 ? \"**ðŸŸ¢ In-Scope Added:**\\n\" + $json.inscope_added.map(i => `<${i}>`).join(\"\\n\") + \"\\n\" : \"\" }}\n{{ $json.outofscope_added.length > 0 ? \"**ðŸ”´ Out-of-Scope Added:**\\n\" + $json.outofscope_added.map(i => `<${i}>`).join(\"\\n\") : \"\" }}",
        "options": {
          "avatar_url": "https://cdn.theorg.com/21070d4f-a207-44e3-9212-22c2e1497205_thumb.jpg"
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        928,
        112
      ],
      "id": "ee04e05c-7aaf-4b44-9300-fc552987f6e4",
      "name": "Discord In-Scope Update Alert",
      "webhookId": "bc408f98-3dfd-4492-bd09-ebb1aa78c693",
      "credentials": {
        "discordWebhookApi": {
          "id": "dlUJMSl5jrn0dkj5",
          "name": "Hackerone Shoten"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77a1b6ec-cae5-4500-8c9d-58b6c41b42fc",
              "name": "handle",
              "value": "={{ $json.handle }}",
              "type": "string"
            },
            {
              "id": "df1d61cc-06f4-4892-9a0c-45da42ffacc6",
              "name": "latest_scope_version_id",
              "value": "=https://hackerone.com/{{ $json.handle }}/policy_scopes",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -448,
        -1120
      ],
      "id": "309d6ad0-fe8e-464f-8588-24644ea66393",
      "name": "Format New Program Alert1"
    }
  ],
  "pinData": {},
  "connections": {
    "Pagination Setup (100-300)": {
      "main": [
        [
          {
            "node": "Split Pagination Values",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Pagination Values": {
      "main": [
        [
          {
            "node": "Fetch HackerOne Programs",
            "type": "main",
            "index": 0
          },
          {
            "node": "Parallel Fetch Programs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch HackerOne Programs": {
      "main": [
        [
          {
            "node": "Merge Program Data",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Program Data": {
      "main": [
        [
          {
            "node": "Extract Program Handles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Program Handles": {
      "main": [
        [
          {
            "node": "Split Program Handles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Scope Versions": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Program Handles": {
      "main": [
        [
          {
            "node": "Get Scope Versions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compare with Database": {
      "main": [
        [
          {
            "node": "Create New Program",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format New Program Alert1",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Extract Handle for Lookup",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Scope Version",
            "type": "main",
            "index": 0
          },
          {
            "node": "Program Scope Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Existing Programs": {
      "main": [
        [
          {
            "node": "Prepare DB Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare DB Data": {
      "main": [
        [
          {
            "node": "Compare with Database",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Schedule Trigger (20min)": {
      "main": [
        [
          {
            "node": "Pagination Setup (100-300)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Existing Programs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Scope Versions": {
      "main": [
        [
          {
            "node": "Extract Scope Versions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Compare with Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Handle for Lookup": {
      "main": [
        [
          {
            "node": "Get Previous Scope",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch Updated Scope Details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Previous Scope": {
      "main": [
        [
          {
            "node": "Prepare Previous Scope",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Previous Scope": {
      "main": [
        [
          {
            "node": "Compare Scope Changes",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Compare Scope Changes": {
      "main": [
        [],
        [],
        [
          {
            "node": "Update Program Scope",
            "type": "main",
            "index": 0
          },
          {
            "node": "Process Scope Changes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Updated Scope Details": {
      "main": [
        [
          {
            "node": "Format Scope Update Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Scope Changes": {
      "main": [
        [
          {
            "node": "Discord In-Scope Update Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parallel Fetch Programs": {
      "main": [
        [
          {
            "node": "Merge Program Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Scope Update Data": {
      "main": [
        [
          {
            "node": "Compare Scope Changes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Program Scope Update": {
      "main": [
        [
          {
            "node": "Discord SCOPE-VERSION Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format New Program Alert1": {
      "main": [
        [
          {
            "node": "Discord New Program Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5f197629-9b5f-428a-8a9e-20037dd401a4",
  "meta": {
    "instanceId": "c5257b5cf4d48704d636909c07c4408a69d6799d0a855eab46287eeb702c84b0"
  },
  "id": "BgWrCjOVnYcGcZRV",
  "tags": [
    {
      "createdAt": "2025-06-24T03:45:29.608Z",
      "updatedAt": "2025-06-24T03:45:29.608Z",
      "id": "xw4nMru5tzSUTx4M",
      "name": "prototype"
    }
  ]
}
